<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tarot Reading</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useCallback, useRef } = React;

    // ============================================
    // IMAGE MAPPING
    // ============================================

    const CARD_IMAGES = {
      back: 'Cards-png/CardBacks.png',
      major: [
        'Cards-png/00-TheFool.png',
        'Cards-png/01-TheMagician.png',
        'Cards-png/02-TheHighPriestess.png',
        'Cards-png/03-TheEmpress.png',
        'Cards-png/04-TheEmperor.png',
        'Cards-png/05-TheHierophant.png',
        'Cards-png/06-TheLovers.png',
        'Cards-png/07-TheChariot.png',
        'Cards-png/08-Strength.png',
        'Cards-png/09-TheHermit.png',
        'Cards-png/10-WheelOfFortune.png',
        'Cards-png/11-Justice.png',
        'Cards-png/12-TheHangedMan.png',
        'Cards-png/13-Death.png',
        'Cards-png/14-Temperance.png',
        'Cards-png/15-TheDevil.png',
        'Cards-png/16-TheTower.png',
        'Cards-png/17-TheStar.png',
        'Cards-png/18-TheMoon.png',
        'Cards-png/19-TheSun.png',
        'Cards-png/20-Judgement.png',
        'Cards-png/21-TheWorld.png'
      ],
      Wands: Array.from({length: 14}, (_, i) => `Cards-png/Wands${String(i + 1).padStart(2, '0')}.png`),
      Cups: Array.from({length: 14}, (_, i) => `Cards-png/Cups${String(i + 1).padStart(2, '0')}.png`),
      Swords: Array.from({length: 14}, (_, i) => `Cards-png/Swords${String(i + 1).padStart(2, '0')}.png`),
      Pentacles: Array.from({length: 14}, (_, i) => `Cards-png/Pentacles${String(i + 1).padStart(2, '0')}.png`)
    };

    const getCardImage = (card) => {
      if (!card) return CARD_IMAGES.back;
      if (card.arcana === 'major') {
        return CARD_IMAGES.major[card.id];
      }
      return CARD_IMAGES[card.suit][card.value - 1];
    };

    // ============================================
    // COMPLETE 78-CARD DECK
    // ============================================

    const MAJOR_ARCANA = [
      { id: 0, name: "The Fool", numeral: "0", arcana: "major", keywords: ["beginnings", "innocence", "spontaneity", "leap of faith"], element: "Air" },
      { id: 1, name: "The Magician", numeral: "I", arcana: "major", keywords: ["manifestation", "willpower", "skill", "resourcefulness"], element: "Air" },
      { id: 2, name: "The High Priestess", numeral: "II", arcana: "major", keywords: ["intuition", "mystery", "inner voice", "unconscious"], element: "Water" },
      { id: 3, name: "The Empress", numeral: "III", arcana: "major", keywords: ["abundance", "nurturing", "fertility", "nature"], element: "Earth" },
      { id: 4, name: "The Emperor", numeral: "IV", arcana: "major", keywords: ["authority", "structure", "control", "father figure"], element: "Fire" },
      { id: 5, name: "The Hierophant", numeral: "V", arcana: "major", keywords: ["tradition", "conformity", "wisdom", "spiritual guidance"], element: "Earth" },
      { id: 6, name: "The Lovers", numeral: "VI", arcana: "major", keywords: ["love", "harmony", "choices", "union"], element: "Air" },
      { id: 7, name: "The Chariot", numeral: "VII", arcana: "major", keywords: ["willpower", "determination", "victory", "control"], element: "Water" },
      { id: 8, name: "Strength", numeral: "VIII", arcana: "major", keywords: ["courage", "patience", "inner strength", "compassion"], element: "Fire" },
      { id: 9, name: "The Hermit", numeral: "IX", arcana: "major", keywords: ["introspection", "solitude", "guidance", "inner wisdom"], element: "Earth" },
      { id: 10, name: "Wheel of Fortune", numeral: "X", arcana: "major", keywords: ["cycles", "fate", "turning point", "destiny"], element: "Fire" },
      { id: 11, name: "Justice", numeral: "XI", arcana: "major", keywords: ["fairness", "truth", "karma", "accountability"], element: "Air" },
      { id: 12, name: "The Hanged Man", numeral: "XII", arcana: "major", keywords: ["surrender", "new perspective", "pause", "letting go"], element: "Water" },
      { id: 13, name: "Death", numeral: "XIII", arcana: "major", keywords: ["transformation", "endings", "change", "transition"], element: "Water" },
      { id: 14, name: "Temperance", numeral: "XIV", arcana: "major", keywords: ["balance", "moderation", "patience", "harmony"], element: "Fire" },
      { id: 15, name: "The Devil", numeral: "XV", arcana: "major", keywords: ["shadow self", "attachment", "addiction", "bondage"], element: "Earth" },
      { id: 16, name: "The Tower", numeral: "XVI", arcana: "major", keywords: ["upheaval", "revelation", "sudden change", "awakening"], element: "Fire" },
      { id: 17, name: "The Star", numeral: "XVII", arcana: "major", keywords: ["hope", "faith", "renewal", "inspiration"], element: "Air" },
      { id: 18, name: "The Moon", numeral: "XVIII", arcana: "major", keywords: ["illusion", "fear", "subconscious", "intuition"], element: "Water" },
      { id: 19, name: "The Sun", numeral: "XIX", arcana: "major", keywords: ["joy", "success", "vitality", "positivity"], element: "Fire" },
      { id: 20, name: "Judgement", numeral: "XX", arcana: "major", keywords: ["rebirth", "inner calling", "reflection", "reckoning"], element: "Fire" },
      { id: 21, name: "The World", numeral: "XXI", arcana: "major", keywords: ["completion", "achievement", "wholeness", "fulfillment"], element: "Earth" }
    ];

    const SUITS = {
      Wands: { element: "Fire", domain: "passion, creativity, action" },
      Cups: { element: "Water", domain: "emotions, relationships, intuition" },
      Swords: { element: "Air", domain: "thoughts, conflict, truth" },
      Pentacles: { element: "Earth", domain: "finances, career, material" }
    };

    const MINOR_CARDS = [
      { rank: "Ace", value: 1, keywords: ["new beginning", "potential", "opportunity"] },
      { rank: "Two", value: 2, keywords: ["balance", "partnership", "duality"] },
      { rank: "Three", value: 3, keywords: ["growth", "creativity", "collaboration"] },
      { rank: "Four", value: 4, keywords: ["stability", "foundation", "structure"] },
      { rank: "Five", value: 5, keywords: ["conflict", "challenge", "change"] },
      { rank: "Six", value: 6, keywords: ["harmony", "communication", "transition"] },
      { rank: "Seven", value: 7, keywords: ["reflection", "assessment", "perseverance"] },
      { rank: "Eight", value: 8, keywords: ["movement", "speed", "progress"] },
      { rank: "Nine", value: 9, keywords: ["fruition", "attainment", "wisdom"] },
      { rank: "Ten", value: 10, keywords: ["completion", "ending", "fulfillment"] },
      { rank: "Page", value: 11, keywords: ["messenger", "student", "new energy"] },
      { rank: "Knight", value: 12, keywords: ["action", "adventure", "movement"] },
      { rank: "Queen", value: 13, keywords: ["nurturing", "intuitive", "mastery"] },
      { rank: "King", value: 14, keywords: ["authority", "control", "leadership"] }
    ];

    const generateMinorArcana = () => {
      const cards = [];
      let id = 22;
      Object.entries(SUITS).forEach(([suit, suitData]) => {
        MINOR_CARDS.forEach(cardData => {
          cards.push({
            id: id++,
            name: `${cardData.rank} of ${suit}`,
            suit,
            rank: cardData.rank,
            value: cardData.value,
            arcana: 'minor',
            element: suitData.element,
            domain: suitData.domain,
            keywords: cardData.keywords
          });
        });
      });
      return cards;
    };

    const FULL_DECK = [...MAJOR_ARCANA, ...generateMinorArcana()];

    // ============================================
    // SPREADS
    // ============================================

    const SPREADS = {
      single: {
        name: "Daily Draw",
        positions: [{ name: "Message", description: "Your guidance for today" }]
      },
      threeCard: {
        name: "Past · Present · Future",
        positions: [
          { name: "Past", description: "What has led to this moment" },
          { name: "Present", description: "Where you are now" },
          { name: "Future", description: "Where this path leads" }
        ]
      },
      situation: {
        name: "Situation · Action · Outcome",
        positions: [
          { name: "Situation", description: "The nature of what you face" },
          { name: "Action", description: "The approach advised" },
          { name: "Outcome", description: "The likely result" }
        ]
      },
      celtic: {
        name: "Celtic Cross",
        positions: [
          { name: "Present", description: "Current situation" },
          { name: "Challenge", description: "Obstacle you face" },
          { name: "Past", description: "Recent influences" },
          { name: "Future", description: "What's coming" },
          { name: "Above", description: "Best outcome" },
          { name: "Below", description: "Subconscious" },
          { name: "Advice", description: "How to approach" },
          { name: "External", description: "Outside influences" },
          { name: "Hopes/Fears", description: "Inner conflict" },
          { name: "Outcome", description: "Final result" }
        ]
      }
    };

    // ============================================
    // 3D CARD COMPONENT WITH IMAGES
    // ============================================

    const Card3D = ({
      card = null,
      isRevealed = false,
      onClick,
      size = 'normal',
      enableHover = false,
      hoverCard = null
    }) => {
      const [rotation, setRotation] = useState({ x: 0, y: 0 });
      const [isHovered, setIsHovered] = useState(false);
      const cardRef = useRef(null);

      const sizes = {
        small: { width: 120, height: 197 },
        normal: { width: 180, height: 295 },
        large: { width: 220, height: 360 }
      };

      const s = sizes[size];

      const handleMouseMove = (e) => {
        if (!cardRef.current) return;
        const rect = cardRef.current.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        setRotation({
          x: ((y - centerY) / centerY) * -10,
          y: ((x - centerX) / centerX) * 10
        });
      };

      const handleMouseLeave = () => {
        setRotation({ x: 0, y: 0 });
        setIsHovered(false);
      };

      const displayCard = isHovered && hoverCard ? hoverCard : card;
      const showFace = (enableHover && isHovered && hoverCard) || isRevealed;

      return (
        <div
          ref={cardRef}
          onClick={onClick}
          onMouseMove={handleMouseMove}
          onMouseEnter={() => setIsHovered(true)}
          onMouseLeave={handleMouseLeave}
          className="cursor-pointer"
          style={{ width: s.width, height: s.height, perspective: 1000 }}
        >
          <div
            style={{
              width: '100%',
              height: '100%',
              position: 'relative',
              transformStyle: 'preserve-3d',
              transition: 'transform 0.6s cubic-bezier(0.4, 0, 0.2, 1)',
              transform: `
                rotateX(${rotation.x}deg)
                rotateY(${rotation.y}deg)
                ${isHovered ? 'translateZ(12px) scale(1.03)' : ''}
              `,
            }}
          >
            {/* Card Back */}
            <div
              style={{
                position: 'absolute',
                width: '100%',
                height: '100%',
                backfaceVisibility: 'hidden',
                borderRadius: 8,
                overflow: 'hidden',
                boxShadow: isHovered
                  ? '0 25px 50px rgba(0,0,0,0.5), 0 0 30px rgba(147, 112, 219, 0.2)'
                  : '0 10px 30px rgba(0,0,0,0.4)',
                transition: 'transform 0.6s cubic-bezier(0.4, 0, 0.2, 1)',
                transform: showFace ? 'rotateY(180deg)' : 'rotateY(0deg)',
              }}
            >
              <img
                src={CARD_IMAGES.back}
                alt="Card back"
                style={{ width: '100%', height: '100%', objectFit: 'cover' }}
              />
            </div>

            {/* Card Face */}
            <div
              style={{
                position: 'absolute',
                width: '100%',
                height: '100%',
                backfaceVisibility: 'hidden',
                borderRadius: 8,
                overflow: 'hidden',
                boxShadow: isHovered ? '0 25px 50px rgba(0,0,0,0.5)' : '0 10px 30px rgba(0,0,0,0.4)',
                transition: 'transform 0.6s cubic-bezier(0.4, 0, 0.2, 1)',
                transform: showFace ? 'rotateY(0deg)' : 'rotateY(-180deg)',
              }}
            >
              {displayCard && (
                <div style={{
                  width: '100%',
                  height: '100%',
                  transform: displayCard.reversed ? 'rotate(180deg)' : 'none',
                }}>
                  <img
                    src={getCardImage(displayCard)}
                    alt={displayCard.name}
                    style={{ width: '100%', height: '100%', objectFit: 'cover' }}
                  />
                </div>
              )}
            </div>
          </div>
        </div>
      );
    };

    // ============================================
    // MAIN APP
    // ============================================

    function TarotReading() {
      const [phase, setPhase] = useState('welcome');
      const [question, setQuestion] = useState('');
      const [selectedSpread, setSelectedSpread] = useState('threeCard');
      const [deck, setDeck] = useState([]);
      const [drawnCards, setDrawnCards] = useState([]);
      const [revealedIndices, setRevealedIndices] = useState([]);
      const [shuffleCount, setShuffleCount] = useState(0);
      const [hoverCards, setHoverCards] = useState([]);
      const [copied, setCopied] = useState(false);

      useEffect(() => { shuffleDeck(); }, []);

      const shuffleDeck = useCallback(() => {
        const shuffled = [...FULL_DECK];
        for (let i = shuffled.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        setDeck(shuffled.map(card => ({ ...card, reversed: Math.random() > 0.7 })));

        const randomCards = [];
        const usedIndices = new Set();
        for (let i = 0; i < 5; i++) {
          let idx;
          do { idx = Math.floor(Math.random() * shuffled.length); }
          while (usedIndices.has(idx));
          usedIndices.add(idx);
          randomCards.push(shuffled[idx]);
        }
        setHoverCards(randomCards);
      }, []);

      const spread = SPREADS[selectedSpread];
      const allRevealed = drawnCards.length > 0 && revealedIndices.length === drawnCards.length;

      const handleShuffle = () => {
        shuffleDeck();
        setShuffleCount(prev => prev + 1);
      };

      const drawCards = () => {
        const numCards = spread.positions.length;
        setDrawnCards(deck.slice(0, numCards));
        setDeck(deck.slice(numCards));
        setRevealedIndices([]);
        setPhase('reading');
      };

      const revealCard = (index) => {
        if (!revealedIndices.includes(index)) {
          setRevealedIndices(prev => [...prev, index]);
        }
      };

      const startOver = () => {
        setPhase('welcome');
        setQuestion('');
        setDrawnCards([]);
        setRevealedIndices([]);
        setShuffleCount(0);
        setCopied(false);
        shuffleDeck();
      };

      const generateReadingSummary = () => {
        let summary = `**Tarot Reading - ${spread.name}**\n`;
        if (question) summary += `Question: "${question}"\n`;
        summary += `\n`;
        drawnCards.forEach((card, index) => {
          const pos = spread.positions[index];
          summary += `**${pos.name}** (${pos.description}): ${card.name}${card.reversed ? ' (Reversed)' : ''}\n`;
        });
        return summary;
      };

      const copyToClipboard = () => {
        navigator.clipboard.writeText(generateReadingSummary());
        setCopied(true);
        setTimeout(() => setCopied(false), 2000);
      };

      return (
        <div className="min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950 text-slate-200">
          <div className="text-center py-6">
            <h1 className="text-xl tracking-[0.4em] text-slate-500 font-light">TAROT</h1>
          </div>

          <div className="max-w-7xl mx-auto px-4 pb-12">

            {/* WELCOME */}
            {phase === 'welcome' && (
              <div className="text-center">
                <p className="text-slate-600 text-sm mb-8">Hover to glimpse the cards</p>

                <div className="flex justify-center gap-4 mb-12">
                  {[0, 1, 2, 3, 4].map((i) => (
                    <div key={i} style={{ transform: `rotate(${(i - 2) * 4}deg)` }}>
                      <Card3D
                        card={hoverCards[i]}
                        size="normal"
                        enableHover={true}
                        hoverCard={hoverCards[i]}
                      />
                    </div>
                  ))}
                </div>

                <div className="space-y-4 max-w-sm mx-auto">
                  <div className="grid grid-cols-2 gap-3">
                    {Object.entries(SPREADS).map(([key, s]) => (
                      <button
                        key={key}
                        onClick={() => setSelectedSpread(key)}
                        className={`p-4 rounded-lg transition-all text-left
                          ${selectedSpread === key
                            ? 'bg-slate-800 ring-1 ring-violet-500/40'
                            : 'bg-slate-900/50 hover:bg-slate-800/50'}`}
                      >
                        <div className="text-slate-300 text-sm">{s.name}</div>
                        <div className="text-xs text-slate-600 mt-1">{s.positions.length} card{s.positions.length > 1 ? 's' : ''}</div>
                      </button>
                    ))}
                  </div>

                  <button
                    onClick={() => setPhase('question')}
                    className="w-full py-4 bg-violet-900/30 hover:bg-violet-800/40 rounded-lg transition-colors text-slate-300 border border-violet-500/20"
                  >
                    Begin Reading
                  </button>
                </div>
              </div>
            )}

            {/* QUESTION */}
            {phase === 'question' && (
              <div className="max-w-md mx-auto text-center">
                <p className="text-slate-500 mb-6">What guidance do you seek?</p>
                <textarea
                  value={question}
                  onChange={(e) => setQuestion(e.target.value)}
                  placeholder="Your question (or leave blank)..."
                  className="w-full bg-slate-900/50 border border-slate-700 rounded-lg p-4 text-slate-200
                    placeholder-slate-600 focus:outline-none focus:border-violet-500/50 resize-none mb-6"
                  rows={3}
                />
                <button
                  onClick={() => setPhase('shuffle')}
                  className="w-full py-4 bg-slate-800 hover:bg-slate-700 rounded-lg transition-colors text-slate-300"
                >
                  Continue
                </button>
              </div>
            )}

            {/* SHUFFLE */}
            {phase === 'shuffle' && (
              <div className="text-center">
                <p className="text-slate-500 mb-8">Focus on your question and click to shuffle</p>
                <div onClick={handleShuffle} className="inline-block cursor-pointer mb-8">
                  <div className="relative" style={{ width: 260, height: 400 }}>
                    {[0, 1, 2, 3, 4, 5].map((i) => (
                      <div
                        key={i}
                        style={{
                          position: 'absolute',
                          top: i * -3,
                          left: i * 3,
                          transform: shuffleCount > 0 ? `rotate(${(Math.random() - 0.5) * 8}deg)` : 'none',
                          transition: 'transform 0.3s',
                        }}
                      >
                        <Card3D size="large" />
                      </div>
                    ))}
                  </div>
                </div>

                <div className="flex justify-center gap-3 mb-6">
                  {[1, 2, 3].map(i => (
                    <div key={i} className={`w-3 h-3 rounded-full transition-all duration-300
                      ${shuffleCount >= i ? 'bg-violet-400 shadow-lg shadow-violet-500/50' : 'bg-slate-700'}`} />
                  ))}
                </div>

                {shuffleCount >= 3 && (
                  <button
                    onClick={drawCards}
                    className="px-8 py-3 bg-violet-900/40 hover:bg-violet-800/50 rounded-lg transition-colors text-slate-300 border border-violet-500/20"
                  >
                    Draw Cards
                  </button>
                )}
              </div>
            )}

            {/* READING */}
            {phase === 'reading' && (
              <div>
                {question && <p className="text-center text-slate-600 mb-8 italic text-lg">"{question}"</p>}

                <div className={`flex flex-wrap justify-center mb-8 ${selectedSpread === 'celtic' ? 'gap-4' : 'gap-6'}`}>
                  {drawnCards.map((card, index) => (
                    <div key={card.id} className="text-center">
                      <p className="text-slate-500 text-sm mb-3 font-medium">{spread.positions[index].name}</p>
                      <Card3D
                        card={card}
                        isRevealed={revealedIndices.includes(index)}
                        onClick={() => revealCard(index)}
                        size={selectedSpread === 'celtic' ? 'small' : 'large'}
                        enableHover={revealedIndices.includes(index)}
                      />
                      {revealedIndices.includes(index) && (
                        <div className="mt-3">
                          <p className="text-slate-300 text-sm font-medium">{card.name}</p>
                          {card.reversed && <p className="text-amber-500/80 text-xs mt-1">Reversed</p>}
                        </div>
                      )}
                    </div>
                  ))}
                </div>

                {!allRevealed && <p className="text-center text-slate-600">Click each card to reveal</p>}

                {allRevealed && (
                  <div className="mt-12 max-w-2xl mx-auto">
                    <div className="bg-slate-900/50 rounded-xl p-6 border border-slate-800">
                      <h3 className="text-slate-400 text-sm font-medium mb-4 uppercase tracking-wider">Reading Summary</h3>
                      <div className="space-y-3">
                        {drawnCards.map((card, index) => (
                          <div key={card.id} className="flex items-start gap-3">
                            <span className="text-violet-400 font-medium min-w-[100px]">{spread.positions[index].name}:</span>
                            <span className="text-slate-300">{card.name}{card.reversed ? <span className="text-amber-500/80 ml-2">(Reversed)</span> : ''}</span>
                          </div>
                        ))}
                      </div>

                      <button
                        onClick={copyToClipboard}
                        className="mt-6 w-full py-3 bg-violet-900/30 hover:bg-violet-800/40 rounded-lg transition-colors text-slate-300 text-sm border border-violet-500/20"
                      >
                        {copied ? '✓ Copied to Clipboard' : 'Copy for Claude'}
                      </button>
                    </div>

                    <div className="text-center mt-8">
                      <button onClick={startOver} className="text-slate-600 hover:text-slate-400 transition-colors">
                        New Reading
                      </button>
                    </div>
                  </div>
                )}
              </div>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<TarotReading />);
  </script>
</body>
</html>
